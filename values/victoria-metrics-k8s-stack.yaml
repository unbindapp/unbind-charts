# victoria-metrics-k8s-stack/values.yaml
vmsingle:
  enabled: true
  spec:
    replicaCount: 1
    retentionPeriod: "7d"
    extraArgs:
      memory.allowedPercent: "50"
      search.maxSamplesPerQuery: "50000"
    resources:
      requests:
        cpu: 10m
        memory: 64Mi
      limits:
        cpu: 100m
        memory: 512Mi
    storage:
      accessModes:
        - ReadWriteOnce
      resources:
        requests:
          storage: 3Gi

vmagent:
  enabled: true
  spec:
    scrapeInterval: 20s
    externalLabels:
      cluster: "local"
    resources:
      requests:
        cpu: 10m
        memory: 32Mi
      limits:
        cpu: 100m
        memory: 512Mi
    extraArgs:
      promscrape.streamParse: "true"
      promscrape.dropOriginalLabels: "true"
      promscrape.seriesLimitPerTarget: "5000"
      remoteWrite.flushInterval: "10s"
  podScrape:
    metricRelabelConfigs:
      - action: keep
        regex: '^(container_cpu_usage_seconds_total|container_memory_working_set_bytes|container_network_(receive|transmit)_bytes_total|kubelet_volume_stats_used_bytes)$'
      - action: labeldrop
        regex: '(container_id|pod_uid|revision|controller_revision_hash)'

victoria-metrics-operator:
  operator:
    resources:
      requests:
        cpu: 30m
        memory: 40Mi
      limits:
        cpu: 200m
        memory: 512Mi

# Exporters
kube-state-metrics:
  enabled: true
  extraArgs:
    - --resources=pods,services,persistentvolumeclaims
    - --metric-labels-allowlist=pods=[label_unbind_team,label_unbind_project,label_unbind_environment,label_unbind_service]
  resources:
    requests:
      cpu: 20m
      memory: 96Mi
    limits:
      cpu: 200m
      memory: 512Mi

prometheus-node-exporter:
  enabled: true
  extraArgs:
    - --collector.disable-defaults
    - --collector.cpu
    - --collector.meminfo
    - --collector.netdev
    - --collector.diskstats
    - --collector.loadavg
  resources:
    requests:
      cpu: 5m
      memory: 16Mi
    limits:
      cpu: 150m
      memory: 512Mi

# Disabled components
grafana:
  enabled: false
  forceDeployDatasource: false

alertmanager:
  enabled: false
vmalert:
  enabled: false
vmauth:
  enabled: false
defaultDashboards:
  enabled: false

# Un-needed control-plane scrapers
kubeEtcd:              { enabled: false }
kubeScheduler:         { enabled: false }
kubeControllerManager: { enabled: false }
kubeProxy:             { enabled: false }
kubeApiServer:         { enabled: false }
coreDns:               { enabled: false }
kubeDns:               { enabled: false }

# Default recording rules
defaultRules:
  create: true
